# API

## Install

Install dependancies with `npm install`

## Start

Start the API server with `[PORT=8000] npm start`

## Routes

```
<movie>: {
  "id": number,
  "title": string,
  "plot": string,
  "released": string,
  "runtime": string,
  "director": string,
  "writer": string,
  "actors": string,
  "poster": string,
  "comments": Array<Comment>
}

<comment>: {
  "id": integer,
  "author": string,
  "comment": string
}
```

`:id` and `:commentId` are placeholders, which must be replaced with a real id.
`<partial movie>` is a movie with eventually missing fields.

- `GET    /api/movies`: retrieve all movies. Returns: `[<movie>, ...]`
- `GET    /api/movies/:id`: retrieve one movie. Returns: `<movie>`
- `POST   /api/movies`: create a movie. Body: `<movie>` (without the `id` field). Returns: `<movie>`
- `PUT    /api/movies/:id`: update an existing movie. Body: `<partial movie>`. Returns: `<movie>`
- `DELETE /api/movies/:id`: remove a movie. This route doesn't return anything.
- `POST   /api/movies/sort`: Update the movies order. Body: `[integer, ...]` (the new movies ids order). Returns: `[<movie>, ...]`

- `POST   /api/movies/:id/comments`: Add a comment to an existing movie. Returns: `<movie>`
- `PUT    /api/movies/:id/comments/:commentId`: Update a comment. Returns: `<movie>`
- `DELETE /api/movies/:id/comments/:commentId`: Delete a comment from an existing movie. This route doesn't return anything.

## Example

Let say the initial movies list is empty. If we request the movies list, the API returns an empty array:
`curl <base_url>/api/movies`
```JSON
[]
```

First, we will add a new movie:
`curl -X POST <base_url>/api/movies --data title="great movie" --data plot="some plot..." --data released="10 Feb 1993" --data runtime="110 min" --data director="NilsCox" --data write="ItiCox" --data actors="JeanneCox, TomCox" --poster="https://fake.domain/image.jpg"`
```JSON
{
  "id": 12,
  "title": "great movie",
  "plot": "some plot...",
  "released": "10 Feb 1993",
  "runtime": "110 min",
  "director": "NilsCox",
  "writer": "ItiCox",
  "actors": "JeanneCox, TomCox",
  "poster": "https://fake.domain/image.jpg",
  "place": 1
}
```

> The id is generated by the API, and is not guaranteed to always be the next available integer, based on the last inserted movie.
> In fact, the generated ids *will* be starting from 1, and are auto incremented. But as this is not guaranteed by the API, the
> examples given here generate random id for the movies and comments.

Now if we request the full movies list again, we fetch an array containing the movie we just added:
`curl <base_url>/api/movies`
```JSON
[
  {
    "id": 12,
    "title": "great movie",
    "plot": "some plot...",
    "released": "10 Feb 1993",
    "runtime": "110 min",
    "director": "NilsCox",
    "writer": "ItiCox",
    "actors": "JeanneCox, TomCox",
    "poster": "https://fake.domain/image.jpg",
    "place": 1
  }
]
```

Let's add a few more:
`curl -X POST <base_url>/api/movies --data title="awesome movie"`
`curl -X POST <base_url>/api/movies --data title="fantastic movie"`
`curl -X POST <base_url>/api/movies --data title="amazing movie"`

The full movies list is now:
`curl <base_url>/api/movies`
```JSON
[
  {
    "id": 12,
    "title": "great movie",
    "place": 1
  },
  {
    "id": 8,
    "title": "awesome movie",
    "place": 2
  },
  {
    "id": 23,
    "title": "fantastic movie",
    "place": 3
  },
  {
    "id": 17,
    "title": "amazing movie",
    "place": 4
  }
]
```

> For readability reason, we will only display the movie id, title and place, but all other fields still exist!

If we need to fetch information about one only movie, based on its id:
`curl <base_url>/api/movies/23`
```JSON
{
  "id": 23,
  "title": "fantastic movie",
  "place": 3
}
```

Now, let's edit an existing movie:
`curl -X PUT <base_url>/api/movies/8 --title="pretty good movie"`
```JSON
{
  id: 8,
  title: "pretty good",
  place: 2
}
```

We can also delete an existing movie:
`curl -X DELETE <base_url>/api/movies/23`

> Note: this API request does not return anything.

The order of the movies is kept by the `place` field, but it can't be edited manually. To change the order of the movies, we need to request:
`curl -X POST <base_url>/api/movies/sort --data order="{"17":2,"8":3}"`
```JSON
[
  {
    "id": 12,
    "title": "great movie",
    "place": 1
  },
  {
    "id": 17,
    "title": "amazing movie",
    "place": 2
  },
  {
    "id": 8,
    "title": "awesome movie",
    "place": 3
  }
]
```

Now, let's add a comment to a movie:
`curl -X POST <base_url>/api/movies/12/comments --data author="raspout" --data comment="I didn't like this movie."`
```JSON
{
  "id": 12,
  "title": "great movie",
  "place": 1,
  "comments": [
    {
      "id": 4,
      "author": "raspout",
      "comment": "I didn't like this movie."
    }
  ]
}
```

We can add a few more...:
`curl -X POST <base_url>/api/movies/12/comments --data author="nils" --data comment="I am not agree. I think it's a nice movie."`
`curl -X POST <base_url>/api/movies/17/comments --data author="vio" --data comment="We need to watch this one soon!"`

Let's recap:
`curl <base_url>/api/movies`
```JSON
[
  {
    "id": 12,
    "title": "great movie",
    "place": 1,
    "comments": [
      {
        "id": 4,
        "author": "raspout",
        "comment": "I didn't like this movie."
      },
      {
        "id": 8,
        "author": "nils",
        "comment": "I am not agree. I think it's a nice movie."
      }
    ]
  },
  {
    "id": 17,
    "title": "amazing movie",
    "place": 2,
    "comments": [
      {
        "id": 9,
        "author": "vio",
        "comment": "We need to watch this one soon!"
      }
    ]
  },
  {
    "id": 8,
    "title": "awesome movie",
    "place": 3
  }
]
```

To edit a comment, that's how it's done:
`curl -X PUT <base_url>/api/movies/12/comments/8 --data comment="I don't agree. I think it's a nice movie."`
```JSON
{
  "id": 12,
  "title": "great movie",
  "place": 1,
  "comments": [
    {
      "id": 4,
      "author": "raspout",
      "comment": "I didn't like this movie."
    },
    {
      "id": 8,
      "author": "nils",
      "comment": "I don't agree. I think it's a nice movie."
    }
  ]
}
```

Finally, to delete a comment:
`curl -X DELETE <base_url>/api/movies/12/comments/8`
```JSON
{
  "id": 12,
  "title": "great movie",
  "place": 1,
  "comments": [
    {
      "id": 4,
      "author": "raspout",
      "comment": "I didn't like this movie."
    }
  ]
}
```

## Author

[NilsCox](https://github.com/nilscox)
